<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Recognition Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .start { background: #4CAF50; color: white; }
        .stop { background: #f44336; color: white; }
        .disabled { background: #666; color: #ccc; cursor: not-allowed; }
        #output {
            border: 1px solid #ccc;
            padding: 15px;
            margin: 20px 0;
            min-height: 100px;
            background: #2a2a2a;
            border-radius: 5px;
        }
        .log {
            font-size: 12px;
            color: #888;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>🎤 Speech Recognition Test</h1>
    
    <div id="status">
        <p>Browser Support: <span id="support-status">Checking...</span></p>
        <p>Recording Status: <span id="recording-status">Not recording</span></p>
    </div>

    <div>
        <button id="start-btn" class="start" onclick="startRecording()">Start Recording</button>
        <button id="stop-btn" class="stop disabled" onclick="stopRecording()" disabled>Stop Recording</button>
    </div>

    <div id="output">
        <strong>Speech Recognition Output:</strong>
        <div id="transcript"></div>
        <div id="logs"></div>
    </div>

    <script>
        let recognition = null;
        let isRecording = false;

        function log(message) {
            const logs = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = 'log';
            logDiv.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            logs.appendChild(logDiv);
            console.log(message);
        }

        function updateUI() {
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const recordingStatus = document.getElementById('recording-status');

            if (isRecording) {
                startBtn.disabled = true;
                startBtn.className = 'start disabled';
                stopBtn.disabled = false;
                stopBtn.className = 'stop';
                recordingStatus.textContent = '🎤 Recording...';
            } else {
                startBtn.disabled = false;
                startBtn.className = 'start';
                stopBtn.disabled = true;
                stopBtn.className = 'stop disabled';
                recordingStatus.textContent = 'Not recording';
            }
        }

        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                log('✅ Speech Recognition API is supported');
                document.getElementById('support-status').textContent = '✅ Supported';
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    log('🎤 Speech recognition started');
                    isRecording = true;
                    updateUI();
                };
                
                recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    
                    if (finalTranscript) {
                        log(`✅ Final: ${finalTranscript}`);
                        const transcriptDiv = document.getElementById('transcript');
                        transcriptDiv.innerHTML += `<div><strong>Final:</strong> ${finalTranscript}</div>`;
                    }
                    
                    if (interimTranscript) {
                        log(`⏳ Interim: ${interimTranscript}`);
                    }
                };
                
                recognition.onerror = (event) => {
                    log(`❌ Error: ${event.error}`);
                    if (event.error === 'not-allowed') {
                        alert('Microphone access was denied. Please allow microphone access and refresh the page.');
                    }
                    isRecording = false;
                    updateUI();
                };
                
                recognition.onend = () => {
                    log('🛑 Speech recognition ended');
                    isRecording = false;
                    updateUI();
                };
                
            } else {
                log('❌ Speech Recognition API not supported');
                document.getElementById('support-status').textContent = '❌ Not supported';
                document.getElementById('start-btn').disabled = true;
                document.getElementById('start-btn').className = 'start disabled';
            }
        }

        function startRecording() {
            if (recognition && !isRecording) {
                try {
                    log('🎤 Attempting to start recording...');
                    recognition.start();
                } catch (error) {
                    log(`❌ Error starting: ${error.message}`);
                }
            }
        }

        function stopRecording() {
            if (recognition && isRecording) {
                try {
                    log('🛑 Stopping recording...');
                    recognition.stop();
                } catch (error) {
                    log(`❌ Error stopping: ${error.message}`);
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('🚀 Initializing speech recognition test...');
            initSpeechRecognition();
            updateUI();
        });
    </script>
</body>
</html> 